# ---------- Stage 1: Builder ----------
FROM node:20-alpine AS builder
WORKDIR /app

# copy dependency files and install
COPY package*.json ./
RUN npm ci --omit=dev

# copy source code
COPY . .

# ---------- Stage 2: Final (Distroless) ----------
FROM gcr.io/distroless/nodejs20-debian12 AS final
WORKDIR /app

# copy only whatâ€™s needed
COPY --from=builder /app /app

# distroless already runs as non-root, no shell inside
EXPOSE 3000
CMD ["index.js"]
